<?xml version="1.0" encoding="utf-8"?>
<project name="edu.uci.isr.infrastructure.bad.buckminster.antlib.eclipse">

	<import file="equinox.xml" />

	<property name="default.eclipse.workspace" value="@{location}/workspace" />
	<property name="default.eclipse.temp" value="${default.equinox.temp}" />
	<property name="default.eclipse.failonerror" value="${default.equinox.failonerror}" />
	<property name="default.eclipse.maxmem" value="${default.equinox.maxmem}" />
	<property name="default.eclipse.maxperm" value="${default.equinox.maxperm}" />

	<macrodef name="eclipse">
		<attribute name="workspace" default="${default.eclipse.workspace}" />
		<attribute name="dir" default="@{workspace}" />
		<attribute name="location" />
		<attribute name="temp" default="${default.eclipse.temp}" />
		<attribute name="failonerror" default="${default.eclipse.failonerror}" />
		<attribute name="maxmem" default="${default.eclipse.maxmem}" />
		<attribute name="maxperm" default="${default.eclipse.maxperm}" />
		<element name="args" optional="true" implicit="true" />
		<sequential>

			<mkdir dir="@{location}/configuration/.settings" />
			<set-if-nonempty property="http.proxySet" value="1" else="0" test="http.proxyHost" />
			<propertyfile file="@{location}/configuration/.settings/org.eclipse.core.net.prefs">
				<entry key="proxyData/HTTPS/host" value="${http.proxyHost}" />
				<entry key="proxyData/HTTPS/port" value="${http.proxyPort}" />
				<entry key="proxyData/HTTPS/hasAuth" value="false" />
				<entry key="proxyData/HTTP/host" value="${http.proxyHost}" />
				<entry key="proxyData/HTTP/port" value="${http.proxyPort}" />
				<entry key="proxyData/HTTP/hasAuth" value="false" />
				<entry key="nonProxiedHosts" value="${http.nonProxyHosts}" />
				<entry key="proxiesEnabled" value="${http.proxySet}" />
				<entry key="eclipse.preferences.version" value="1" />
			</propertyfile>

			<mkdir dir="@{workspace}" />
			<equinox location="@{location}" temp="@{temp}" failonerror="@{failonerror}" maxmem="@{maxmem}" maxperm="@{maxperm}" dir="@{dir}">
				<arg value="-data" />
				<arg value="@{workspace}" />
				<args />
			</equinox>
		</sequential>
	</macrodef>

</project>
